<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Controller Tester</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css'>
  <style>
    input[type=range].slider {
      -webkit-appearance: none;
      width: 50%;
      height: 6px;
      background: #ddd;
      border-radius: 5px;
      outline: none;
      transition: background 0.3s;
    }

    input[type=range].slider:hover {
      background: #ccc;
    }

    input[type=range].slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007aff;
      cursor: pointer;
      transition: background 0.3s;
    }

    input[type=range].slider::-webkit-slider-thumb:hover {
      background: #0051c2;
    }

    input[type=range].slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007aff;
      cursor: pointer;
      transition: background 0.3s;
    }

    input[type=range].slider::-moz-range-thumb:hover {
      background: #0051c2;
    }

    input[type=range].slider::-ms-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007aff;
      cursor: pointer;
      transition: background 0.3s;
    }

    input[type=range].slider::-ms-thumb:hover {
      background: #0051c2;
    }

    input[type=range].slider::-ms-track {
      width: 100%;
      height: 6px;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }
  </style>
</head>

<body>
  <div id="app" class="column">
    <template v-if="gamepad">
      <h4 class="title">Vibration controller</h4>
      <div class="field">
        <label class="label">Intensity</label>
        <div class="control">
          <input class="slider" type="range" min="0" max="100" v-model="magnitude">
        </div>
        <span>{{ magnitude }}</span>
      </div>
      <div class="field">
        <label class="label">Control</label>
        <div class="control">
          <button class="button is-primary" type="button" @click="toggleGo">
            {{ button }}
          </button>
        </div>
      </div>
    </template>
    <div v-else>
      <h4 class="title">No controller found</h4>
      <h5 class="title is-5">You may need to press a button on your controller, if it's connected</h5>
    </div>
  </div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.min.js'></script>
  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          gamepad: null,
          magnitude: 0,
          go: false
        }
      },
      created() {
        const pollGamepads = setInterval(() => {
          const gamepad = navigator.getGamepads()[0];
          if (gamepad) {
            this.gamepad = gamepad;
            clearInterval(pollGamepads);
          }
        }, 400);
      },
      methods: {
        toggleGo() {
          this.go = !this.go;
          if (this.go) this.vibrate();
        },
        vibrate() {
          this.gamepad.vibrationActuator.playEffect('dual-rumble', {
            duration: 100,
            strongMagnitude: this.magnitude / 100,
            weakMagnitude: this.magnitude / 100
          })
            .then(() => {
              if (this.go) this.vibrate();
            })
            .catch(err => console.log(err));
        }
      },
      computed: {
        button() {
          return this.go ? 'Stop' : 'Go';
        }
      }
    });
  </script>
</body>

</html>
